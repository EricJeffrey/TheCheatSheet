<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìùTheCheatsheet-ÈÄüÊü•Ë°®</title>
    <!-- ÂºÄÂèëÁéØÂ¢ÉÁâàÊú¨ÔºåÂåÖÂê´‰∫ÜÊúâÂ∏ÆÂä©ÁöÑÂëΩ‰ª§Ë°åË≠¶Âëä -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->
    <!-- Áîü‰∫ßÁéØÂ¢ÉÁâàÊú¨ -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
    <style>
        body,
        html {
            margin: 0px;
            height: 100%;
            background-color: white;
            overflow-y: hidden;
        }

        input,
        textarea {
            padding: 10px;
            margin-bottom: 10px;
            font-size: medium;
            font-family: Consolas, "Á≠âÁ∫ø", 'ÂæÆËΩØÈõÖÈªë';
            resize: vertical;
            outline: none;
            border-radius: 5px;
            border: lightskyblue 1px solid;
            transition: all 300ms ease;
        }
        input:hover, textarea:hover {
            box-shadow: skyblue 1px 1px 16px;
        }

        input:last-child,
        textarea:last-child {
            margin-bottom: 0px;
        }

        ul {
            margin: 0px;
            padding: 0px;
        }

        li {
            display: block;

        }

        button {
            background-color: lightskyblue;
            border: none;
            padding: 10px 0px;
            transition: 300ms ease all;
            font-size: medium;
            font-weight: bold;
        }

        button:hover {
            background-color: #5da6c4;
            color: white;
        }

        ::-webkit-scrollbar {
            max-width: 6px !important;
            max-height: 6px !important;
            background: white !important;
        }

        ::-webkit-scrollbar-track,
        ::-webkit-scrollbar-corner {
            background: white !important;
        }

        ::-webkit-scrollbar-thumb {
            background: lightskyblue !important;
            transition: 300ms ease all;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgb(114, 173, 197) !important;
        }

        .flexRow {
            display: flex;
            flex-direction: row;
        }

        .flexCol {
            display: flex;
            flex-direction: column;
        }

        #copyHelperInput {
            position: absolute;
            opacity: 0;
        }

        #notifyHelperDiv {
            padding: 10px 25px;
            background-color: white;
            box-shadow: lightgray 1px 1px 16px;
            border-radius: 5px;
            color: #039aff;
            transition: all 200ms ease;
            position: absolute;
            margin-left: auto;
            margin-right: 10px;
            width: fit-content;
            float: right;
            right: 0;
            text-align: center;
            top: 20px;
            opacity: 0;
        }


        #app {
            width: 80%;
            margin: auto;
            display: flex;
            height: 100%;
        }

        #header {
            padding: 10px;
        }

        #logo {
            font-size: xx-large;
            font-family: 'Lucida Calligraphy', Consolas, 'Á≠âÁ∫ø';
            font-weight: bold;
            color: #3490dc;
            cursor: pointer;
        }

        #main {
            flex-grow: 0;
            overflow-y: hidden;
        }


        .labelDiv {
            font-size: x-large;
            font-weight: bold;
            margin-bottom: 10px;
            color: #3490dc;
        }

        #searchHolderDiv,
        #addSegmentDiv {
            flex: 1;
            padding: 10px;
            max-width: 50%;
        }

        #searchInput{
            /* border: None; */
            /* box-shadow: darkgrey 1px 1px 10px; */
            /* outline: None; */
            margin-left: 5px;
        }

        #searchResultDiv {
            overflow-y: auto;
            overflow-x: hidden;
            padding-left: 5px;
            padding-right: 10px;
            padding-bottom: 10px;
        }

        .searchResultNoDataDiv {
            text-align: center;
            margin-bottom: 10px;
        }

        .segmentCardDiv {
            transition: all ease 300ms;
            margin-bottom: 10px;
            padding: 15px;
            /* box-shadow: darkgray 1px 1px 6px; */
            border-radius: 5px;
            margin-top: 15px;
            background-color: white;
            border: lightskyblue 1px solid;
        }

        .segmentCardDiv:hover {
            box-shadow: skyblue 1px 1px 16px;

        }

        .segmentCardDiv:last-child {
            margin-bottom: 0px;
        }

        .segmentCardDiv>div {
            margin-bottom: 10px;
        }

        .segmentTitleDiv {
            font-weight: bold;
        }

        .segmentContentDiv {
            overflow-x: auto;
            padding: 10px 5px;
            border: solid rgba(65, 96, 105, 0.425) 1px;
            border-radius: 5px;
        }

        pre {
            margin: 3px;
        }

        .segmentContentCode {
            font-family: Consolas, 'Á≠âÁ∫ø';
            font-size: medium;
        }

        .segmentTagDiv {
            border-radius: 10px;
            padding: 5px;
            border: lightgray 1px solid;
            margin-right: 10px;
            cursor: pointer;
            transition: 300ms ease all;
        }

        .segmentTagDiv:hover {
            background: lightskyblue;
            border-color: skyblue;
	}

        .segmentTagDiv:last-child {
            margin-right: 0px;
        }

        .doCopySpan {
            cursor: pointer;
            text-decoration: underline;
            font-size: small;
            color: cornflowerblue;
            flex-grow: 1;
            text-align: end;
        }
    </style>

    <script>
        const CODE_SUCCESS = 100;
        function showNotify(content) {
            var notifyHelper = document.getElementById("notifyHelperDiv");
            notifyHelper.innerText = content;
            notifyHelper.style.opacity = 1;
            setTimeout(() => {
                notifyHelper.style.opacity = 0;
            }, 2500);
        }

        function regAndLogin(whatToDo) {
            async function job() {
                await (await fetch("/register", {
                    method: "POST",
                    body: JSON.stringify({
                        email: "xxx@xxx.com",
                        name: "jeffrey",
                        password: "123"
                    })
                })).json();
                var loginRes = await (await fetch("/login", {
                    method: "POST",
                    body: JSON.stringify({
                        email: "xxx@xxx.com",
                        password: "123"
                    })
                })).json();

                if (loginRes["code"] != CODE_SUCCESS)
                    throw "ÁôªÂΩïÂ§±Ë¥•: " + loginRes["errorMsg"];
            }

            if (document.cookie.indexOf("uid") == -1) {
                job().then(() => {
                    whatToDo();
                }).catch(() => {
                    showNotify("ÁôªÂΩïÂ§±Ë¥•");
                });
            } else {
                whatToDo();
            }
        }

        function clearAddSegmentContent() {
            document.getElementById("titleInput").value = "";
            document.getElementById("descTextArea").value = "";
            document.getElementById("contentTextArea").value = "";
            document.getElementById("tagsInput").value = "";
        }
    </script>
</head>

<body>
    <textarea id="copyHelperInput"></textarea>
    <div id="notifyHelperDiv"></div>
    <div id="app" class="flexCol">
        <div id="header" class="flexRow">
            <div id="logo">TheCheatsheet</div>
        </div>
        <div id="main" class="flexRow">
            <div id="searchHolderDiv" class="flexCol">
                <div class="labelDiv" style="margin-left: 5px">ÊêúÁ¥¢‰ª£Á†ÅÊÆµ</div>
                <input type="text" name="search" id="searchInput" autofocus="autofocus" placeholder="(‚Ä¢_‚Ä¢)" v-on:keyup.enter="doSearch">
                <div class="flexCol" id="searchResultDiv">
                    <div class="searchResultNoDataDiv" v-if="searchResult.segments.length == 0"> Ê≤°ÊúâÊï∞ÊçÆ ‚äôÔπè‚äô </div>
                    <div class="segmentCardDiv flexCol" v-for="item in searchResult.segments">
                        <div class="segmentCardHeaderDiv flexRow">
                            <div class="segmentTitleDiv"> {{item.title}} </div>
                            <span class="doCopySpan" v-on:click="doCopy(item.content)">Â§çÂà∂</span>
                        </div>
                        <!-- <div class="segmentDescDiv"> {{searchResult.lfConvertedData(item.description)}} </div> !-->
                        <div class="segmentDescDiv"> {{ item.description }} </div>
                        <div class="segmentContentDiv">
                            <code><pre class="segmentContentCode">{{item.content}}</pre></code>
                        </div>
                        <div class="segmentTagListDiv flexRow">
                            <div class="segmentTagDiv" v-for="tag in item.tagList">
                                {{tag}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="addSegmentDiv" class="flexCol">
                <div class="labelDiv">Ê∑ªÂä†‰ª£Á†ÅÊÆµ</div>
                <input type="text" name="title" id="titleInput" placeholder="Ê†áÈ¢ò">
                <textarea name="description" id="descTextArea" cols="30" rows="3" placeholder="ÊèèËø∞"></textarea>
                <textarea name="content" id="contentTextArea" cols="30" rows="10" placeholder="‰ª£Á†ÅÊÆµÂÜÖÂÆπ"></textarea>
                <input type="text" name="tags" id="tagsInput" placeholder="ÈÄóÂè∑ÂàÜÈöîÁöÑÊ†áÁ≠æÔºå‰æã: linux,python">
                <button id="addSegmentButton" v-on:click="doAdd">Ê∑ªÂä†</button>
            </div>
        </div>
    </div>
    <script>
        var app = new Vue({
            el: "#app",
            data: {
                searchResult: {
                    segments: [],
                    lfConvertedData: function (data) {
                        if (data)
                            return data.replace('\n', '<br />');
                        return "";
                    },
                },
                doCopy: function (content) {
                    /* navigator.clipboard.writeText(content); */
                    var helperInput = document.getElementById("copyHelperInput");
                    helperInput.value = content;
                    helperInput.select();
                    helperInput.setSelectionRange(0, 99999);
                    document.execCommand("copy");
                    showNotify("Â∑≤Â§çÂà∂");
                },
                doSearch: function () {
                    var text = document.getElementById("searchInput").value.trim();
                    if (text.length == 0) {
                        showNotify("ÊêúÁ¥¢ÊñáÂ≠ó‰∏çËÉΩ‰∏∫Á©∫");
                    } else {
                        fetch("/search?text=" + text).then(v => {
                            if (v.ok) {
                                v.json().then(vv => {
                                    if (vv["code"] == CODE_SUCCESS)
                                        this.searchResult.segments = vv["result"]["codeSegments"];
                                    else showNotify("ÊêúÁ¥¢Â§±Ë¥•: " + vv["errorMsg"]);
                                })
                            } else
                                throw "Â§±Ë¥•";
                        }).catch(() => { showNotify("ÊêúÁ¥¢Â§±Ë¥•"); });
                    }
                },
                doAdd: function () {
                    console.log("doaddnow");
                    /* note we are accessing dom here */
                    var title = document.getElementById("titleInput").value.trim();
                    var desc = document.getElementById("descTextArea").value.trim();
                    var content = document.getElementById("contentTextArea").value.trim();
                    var commaSeperatedTags = document.getElementById("tagsInput").value.trim();
                    if (title.length == 0 || content.length == 0) {
                        showNotify("Ê†áÈ¢òÂíåÂÜÖÂÆπ‰∏çËÉΩ‰∏∫Á©∫");
                        return;
                    }
                    var tagList = [];
                    if (commaSeperatedTags.length > 0) {
                        const tmpList = commaSeperatedTags.split(',');
                        for (let i = 0; i < tmpList.length; i++) {
                            if (tmpList[i].trim().length > 0)
                                tagList.push(tmpList[i].trim());
                        }
                    }
                    const data = {
                        title: title,
                        description: desc,
                        content: content,
                        createdAt: Date.now(),
                        lastModified: Date.now(),
                        favorNumber: 0,
                        tagList: tagList
                    };
                    regAndLogin(() => {
                        fetch("/addCodeSegment", { method: "POST", body: JSON.stringify({ codeSegment: data }) })
                            .then(v => {
                                if (v.ok) {
                                    v.json().then(vv => {
                                        if (vv["code"] == CODE_SUCCESS) {
                                            showNotify("Ê∑ªÂä†ÊàêÂäü");
                                            clearAddSegmentContent();
                                        }
                                        else { showNotify("Ê∑ªÂä†Â§±Ë¥•: " + vv["errorMsg"]) };
                                    });
                                } else { showNotify("Ê∑ªÂä†Â§±Ë¥•"); }
                            })
                            .catch((v) => {
                                showNotify("Ê∑ªÂä†Â§±Ë¥•ÔºåÁΩëÁªúÈîôËØØ");
                                console.log(v);
                            });
                    });
                }
            },
            created: function () {
                fetch("/getCodeSegments?pageSize=100")
                    .then(v => {
                        if (v.ok) {
                            v.json().then(vv => {
                                if (vv["code"] == CODE_SUCCESS) { this.searchResult.segments = vv["result"]["codeSegments"]; }
                                else { showNotify("Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•: " + vv["errorMsg"]); }
                            });
                        } else {
                            showNotify("Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•");
                        }
                    }).catch(v => {
                        showNotify("Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•ÔºåÁΩëÁªúÈîôËØØ");
                    });
            },
            mounted: function () {
                document.getElementById("searchInput").focus();
            }
        });

    </script>
</body>

</html>

<!-- 
How to center a ‚Äúposition: absolute‚Äù element
position: absolute;
margin-left: auto;
margin-right: auto;
left: 0;
right: 0;
text-align: center;
 -->
